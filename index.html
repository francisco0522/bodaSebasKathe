<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>Galería Google Drive</title>
  <style>
    img { max-width: 200px; margin: 5px; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>Subir imagen a Google Drive</h1>

  <!-- Formulario POST a Apps Script en iframe oculto -->
  <form id="photoForm" action="https://script.google.com/macros/s/AKfycbzAsS5OO1sylQKKRmudpPPOfBrvbtxpDupauk9uYxEhSMWRdFhyveCR4RN42bmCEH2l/exec" method="post" enctype="multipart/form-data" target="hidden_iframe">
    <input type="file" name="file" accept="image/*" required>
    <button type="submit">Subir</button>
  </form>

  <iframe name="hidden_iframe" style="display:none;"></iframe>

  <h2>Galería</h2>
  <div id="galeria"></div>

  <script>
    const galeria = document.getElementById('galeria');
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzAsS5OO1sylQKKRmudpPPOfBrvbtxpDupauk9uYxEhSMWRdFhyveCR4RN42bmCEH2l/exec'; // Igual que el form action

    // Escuchar mensajes del iframe (cuando se sube la imagen)
    window.addEventListener('message', (event) => {
      const url = event.data;
      if (url) agregarImagen(url);
    });

    function agregarImagen(url) {
      const img = document.createElement('img');
      img.src = url.replace('/view','/preview');
      galeria.appendChild(img);
    }

    // Cargar la galería inicial usando un iframe
    const iframe = document.createElement('iframe');
    iframe.src = WEB_APP_URL;
    iframe.style.width = '100%';
    iframe.style.height = '400px';
    iframe.style.border = 'none';
    document.getElementById('galeria').appendChild(iframe);
  </script>
</body>
</html>
