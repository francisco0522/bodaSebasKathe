<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>Galería Google Drive</title>
  <style>
    img { max-width: 200px; margin: 5px; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>Subir imagen a Google Drive 1</h1>

  <!-- Formulario directo a Apps Script -->
  <form id="photoForm" action="https://script.google.com/macros/s/AKfycbw6B7_0_WUeQaTxlxEJ4moBt-QNRU-zZu793Jttuea53xcUpYE3Ko4S1rzNgdEBm5KT/exec" method="post" enctype="multipart/form-data" target="hidden_iframe">
    <input type="file" name="file" accept="image/*" required>
    <button type="submit">Subir</button>
  </form>

  <iframe name="hidden_iframe" style="display:none;"></iframe>

  <h2>Galería</h2>
  <div id="galeria"></div>

  <script>
    const galeria = document.getElementById('galeria');
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbw6B7_0_WUeQaTxlxEJ4moBt-QNRU-zZu793Jttuea53xcUpYE3Ko4S1rzNgdEBm5KT/exec'; // mismo que el action del form

    // Escuchar mensajes del iframe (cuando se sube la imagen)
    window.addEventListener('message', (event) => {
      const url = event.data;
      if (url) {
        agregarImagen(url);
      }
    });

    // Cargar imagen en la galería
    function agregarImagen(url) {
      const img = document.createElement('img');
      img.src = url.replace('/view', '/preview');
      galeria.appendChild(img);
    }

    // Cargar imágenes existentes (opcional)
    async function cargarImagenes() {
      const res = await fetch(WEB_APP_URL); // GET para listar imágenes
      const urls = await res.json();
      urls.forEach(url => agregarImagen(url));
    }

    cargarImagenes();
  </script>
</body>
</html>
