<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Home</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="styles.css" />
    <style>
      img {
        max-width: 200px;
        margin: 5px;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <nav>
      <a href="/" aria-current="page">Home</a>
      <a href="/page2.html">Other page</a>
    </nav>

    <main>
      <h1>Home page</h1>

      <!-- Formulario para mensajes -->
      <form id="msgForm">
        <input
          type="text"
          id="mensaje"
          placeholder="Escribe un mensaje"
          required
        />
        <button type="submit">Guardar mensaje</button>
      </form>

      <h2>ğŸ“‹ Mensajes guardados</h2>
      <ul id="lista"></ul>

      <hr />

      <!-- Formulario para fotos -->
      <h2>ğŸ“¸ Subir una foto</h2>
      <form id="photoForm">
        <input type="file" id="foto" accept="image/*" required />
        <button type="submit">Subir foto</button>
      </form>

      <h2>ğŸ–¼ GalerÃ­a</h2>
      <div id="galeria"></div>
    </main>

    <!-- Firebase -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
      import {
        getFirestore,
        collection,
        addDoc,
        getDocs,
      } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
      import {
        getStorage,
        ref,
        uploadBytes,
        getDownloadURL,
      } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js';

      // ğŸ”¥ ConfiguraciÃ³n de tu proyecto
      const firebaseConfig = {
        apiKey: 'AIzaSyBFaJ6SNZQzZIp2TphzeLydvxozCJiVJlE',
        authDomain: 'boda-sebas-y-kathe.firebaseapp.com',
        projectId: 'boda-sebas-y-kathe',
        storageBucket: 'boda-sebas-y-kathe.appspot.com',
        messagingSenderId: '466003894682',
        appId: '1:466003894682:web:534ef8366ad39c224f5a23',
        measurementId: 'G-QMQBZKYLLK',
      };

      // Inicializar Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const storage = getStorage(app);

      // -----------------------------
      // ğŸ“‹ MENSAJES
      // -----------------------------
      const form = document.getElementById('msgForm');
      const lista = document.getElementById('lista');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const texto = document.getElementById('mensaje').value;

        await addDoc(collection(db, 'mensajes'), {
          texto,
          fecha: new Date(),
        });

        form.reset();
        cargarMensajes();
      });

      async function cargarMensajes() {
        lista.innerHTML = '';
        const snapshot = await getDocs(collection(db, 'mensajes'));
        snapshot.forEach((doc) => {
          const li = document.createElement('li');
          li.textContent = doc.data().texto;
          lista.appendChild(li);
        });
      }

      // -----------------------------
      // ğŸ“¸ FOTOS
      // -----------------------------
      const photoForm = document.getElementById('photoForm');
      const galeria = document.getElementById('galeria');

      photoForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const archivo = document.getElementById('foto').files[0];
        if (!archivo) return;

        // 1. Subir archivo a Storage
        const storageRef = ref(storage, 'imagenes/' + archivo.name);
        await uploadBytes(storageRef, archivo);

        // 2. Obtener URL pÃºblica
        const url = await getDownloadURL(storageRef);

        // 3. Guardar referencia en Firestore
        await addDoc(collection(db, 'imagenes'), {
          url,
          fecha: new Date(),
        });

        photoForm.reset();
        cargarImagenes();
      });

      async function cargarImagenes() {
        galeria.innerHTML = '';
        const snapshot = await getDocs(collection(db, 'imagenes'));
        snapshot.forEach((doc) => {
          const img = document.createElement('img');
          img.src = doc.data().url;
          galeria.appendChild(img);
        });
      }

      // -----------------------------
      // ğŸš€ INICIO
      // -----------------------------
      cargarMensajes();
      cargarImagenes();
    </script>
  </body>
</html>
